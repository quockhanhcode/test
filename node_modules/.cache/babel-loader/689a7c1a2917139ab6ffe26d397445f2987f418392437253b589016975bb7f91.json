{"ast":null,"code":"import _extends from \"@babel/runtime/helpers/esm/extends\";\nimport * as React from 'react';\nimport { unstable_ownerDocument as ownerDocument } from '@mui/utils';\nimport { useGridLogger } from '../../utils/useGridLogger';\nimport { gridExpandedRowCountSelector } from '../filter/gridFilterSelector';\nimport { gridColumnDefinitionsSelector, gridColumnVisibilityModelSelector } from '../columns/gridColumnsSelector';\nimport { gridClasses } from '../../../constants/gridClasses';\nimport { useGridApiMethod } from '../../utils/useGridApiMethod';\nimport { gridRowsMetaSelector } from '../rows/gridRowsMetaSelector';\nimport { getColumnsToExport } from './utils';\nimport { useGridRegisterPipeProcessor } from '../../core/pipeProcessing';\nimport { GridPrintExportMenuItem } from '../../../components/toolbar/GridToolbarExport';\nimport { getTotalHeaderHeight } from '../columns/gridColumnsUtils';\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nfunction raf() {\n  return new Promise(resolve => {\n    requestAnimationFrame(() => {\n      resolve();\n    });\n  });\n}\nfunction buildPrintWindow(title) {\n  const iframeEl = document.createElement('iframe');\n  iframeEl.style.position = 'absolute';\n  iframeEl.style.width = '0px';\n  iframeEl.style.height = '0px';\n  iframeEl.title = title || document.title;\n  return iframeEl;\n}\n\n/**\r\n * @requires useGridColumns (state)\r\n * @requires useGridFilter (state)\r\n * @requires useGridSorting (state)\r\n * @requires useGridParamsApi (method)\r\n */\nexport const useGridPrintExport = (apiRef, props) => {\n  const logger = useGridLogger(apiRef, 'useGridPrintExport');\n  const doc = React.useRef(null);\n  const previousGridState = React.useRef(null);\n  const previousColumnVisibility = React.useRef({});\n  React.useEffect(() => {\n    doc.current = ownerDocument(apiRef.current.rootElementRef.current);\n  }, [apiRef]);\n\n  // Returns a promise because updateColumns triggers state update and\n  // the new state needs to be in place before the grid can be sized correctly\n  const updateGridColumnsForPrint = React.useCallback((fields, allColumns) => new Promise(resolve => {\n    // TODO remove unused Promise\n    if (!fields && !allColumns) {\n      resolve();\n      return;\n    }\n    const exportedColumnFields = getColumnsToExport({\n      apiRef,\n      options: {\n        fields,\n        allColumns\n      }\n    }).map(column => column.field);\n    const columns = gridColumnDefinitionsSelector(apiRef);\n    const newColumnVisibilityModel = {};\n    columns.forEach(column => {\n      newColumnVisibilityModel[column.field] = exportedColumnFields.includes(column.field);\n    });\n    apiRef.current.setColumnVisibilityModel(newColumnVisibilityModel);\n    resolve();\n  }), [apiRef]);\n  const handlePrintWindowLoad = React.useCallback((printWindow, options) => {\n    var _querySelector, _querySelector2;\n    const normalizeOptions = _extends({\n      copyStyles: true,\n      hideToolbar: false,\n      hideFooter: false\n    }, options);\n    const printDoc = printWindow.contentDocument;\n    if (!printDoc) {\n      return;\n    }\n    const rowsMeta = gridRowsMetaSelector(apiRef.current.state);\n    const gridRootElement = apiRef.current.rootElementRef.current;\n    const gridClone = gridRootElement.cloneNode(true);\n\n    // Allow to overflow to not hide the border of the last row\n    const gridMain = gridClone.querySelector(`.${gridClasses.main}`);\n    gridMain.style.overflow = 'visible';\n\n    // See https://support.google.com/chrome/thread/191619088?hl=en&msgid=193009642\n    gridClone.style.contain = 'size';\n    const columnHeaders = gridClone.querySelector(`.${gridClasses.columnHeaders}`);\n    const columnHeadersInner = columnHeaders.querySelector(`.${gridClasses.columnHeadersInner}`);\n    columnHeadersInner.style.width = '100%';\n    let gridToolbarElementHeight = ((_querySelector = gridRootElement.querySelector(`.${gridClasses.toolbarContainer}`)) == null ? void 0 : _querySelector.offsetHeight) || 0;\n    let gridFooterElementHeight = ((_querySelector2 = gridRootElement.querySelector(`.${gridClasses.footerContainer}`)) == null ? void 0 : _querySelector2.offsetHeight) || 0;\n    if (normalizeOptions.hideToolbar) {\n      var _gridClone$querySelec;\n      (_gridClone$querySelec = gridClone.querySelector(`.${gridClasses.toolbarContainer}`)) == null ? void 0 : _gridClone$querySelec.remove();\n      gridToolbarElementHeight = 0;\n    }\n    if (normalizeOptions.hideFooter) {\n      var _gridClone$querySelec2;\n      (_gridClone$querySelec2 = gridClone.querySelector(`.${gridClasses.footerContainer}`)) == null ? void 0 : _gridClone$querySelec2.remove();\n      gridFooterElementHeight = 0;\n    }\n\n    // Expand container height to accommodate all rows\n    gridClone.style.height = `${rowsMeta.currentPageTotalHeight + getTotalHeaderHeight(apiRef, props.columnHeaderHeight) + gridToolbarElementHeight + gridFooterElementHeight}px`;\n    // The height above does not include grid border width, so we need to exclude it\n    gridClone.style.boxSizing = 'content-box';\n\n    // printDoc.body.appendChild(gridClone); should be enough but a clone isolation bug in Safari\n    // prevents us to do it\n    const container = document.createElement('div');\n    container.appendChild(gridClone);\n    printDoc.body.innerHTML = container.innerHTML;\n    const defaultPageStyle = typeof normalizeOptions.pageStyle === 'function' ? normalizeOptions.pageStyle() : normalizeOptions.pageStyle;\n    if (typeof defaultPageStyle === 'string') {\n      // TODO custom styles should always win\n      const styleElement = printDoc.createElement('style');\n      styleElement.appendChild(printDoc.createTextNode(defaultPageStyle));\n      printDoc.head.appendChild(styleElement);\n    }\n    if (normalizeOptions.bodyClassName) {\n      printDoc.body.classList.add(...normalizeOptions.bodyClassName.split(' '));\n    }\n    const stylesheetLoadPromises = [];\n    if (normalizeOptions.copyStyles) {\n      const rootCandidate = gridRootElement.getRootNode();\n      const root = rootCandidate.constructor.name === 'ShadowRoot' ? rootCandidate : doc.current;\n      const headStyleElements = root.querySelectorAll(\"style, link[rel='stylesheet']\");\n      for (let i = 0; i < headStyleElements.length; i += 1) {\n        const node = headStyleElements[i];\n        if (node.tagName === 'STYLE') {\n          const newHeadStyleElements = printDoc.createElement(node.tagName);\n          const sheet = node.sheet;\n          if (sheet) {\n            let styleCSS = '';\n            // NOTE: for-of is not supported by IE\n            for (let j = 0; j < sheet.cssRules.length; j += 1) {\n              if (typeof sheet.cssRules[j].cssText === 'string') {\n                styleCSS += `${sheet.cssRules[j].cssText}\\r\\n`;\n              }\n            }\n            newHeadStyleElements.appendChild(printDoc.createTextNode(styleCSS));\n            printDoc.head.appendChild(newHeadStyleElements);\n          }\n        } else if (node.getAttribute('href')) {\n          // If `href` tag is empty, avoid loading these links\n\n          const newHeadStyleElements = printDoc.createElement(node.tagName);\n          for (let j = 0; j < node.attributes.length; j += 1) {\n            const attr = node.attributes[j];\n            if (attr) {\n              newHeadStyleElements.setAttribute(attr.nodeName, attr.nodeValue || '');\n            }\n          }\n          stylesheetLoadPromises.push(new Promise(resolve => {\n            newHeadStyleElements.addEventListener('load', () => resolve());\n          }));\n          printDoc.head.appendChild(newHeadStyleElements);\n        }\n      }\n    }\n\n    // Trigger print\n    if (process.env.NODE_ENV !== 'test') {\n      // wait for remote stylesheets to load\n      Promise.all(stylesheetLoadPromises).then(() => {\n        printWindow.contentWindow.print();\n      });\n    }\n  }, [apiRef, doc, props.columnHeaderHeight]);\n  const handlePrintWindowAfterPrint = React.useCallback(printWindow => {\n    var _previousGridState$cu;\n    // Remove the print iframe\n    doc.current.body.removeChild(printWindow);\n\n    // Revert grid to previous state\n    apiRef.current.restoreState(previousGridState.current || {});\n    if (!((_previousGridState$cu = previousGridState.current) != null && (_previousGridState$cu = _previousGridState$cu.columns) != null && _previousGridState$cu.columnVisibilityModel)) {\n      // if the apiRef.current.exportState(); did not exported the column visibility, we update it\n      apiRef.current.setColumnVisibilityModel(previousColumnVisibility.current);\n    }\n    apiRef.current.unstable_enableVirtualization();\n\n    // Clear local state\n    previousGridState.current = null;\n    previousColumnVisibility.current = {};\n  }, [apiRef]);\n  const exportDataAsPrint = React.useCallback(async options => {\n    logger.debug(`Export data as Print`);\n    if (!apiRef.current.rootElementRef.current) {\n      throw new Error('MUI: No grid root element available.');\n    }\n    previousGridState.current = apiRef.current.exportState();\n    // It appends that the visibility model is not exported, especially if columnVisibility is not controlled\n    previousColumnVisibility.current = gridColumnVisibilityModelSelector(apiRef);\n    if (props.pagination) {\n      const visibleRowCount = gridExpandedRowCountSelector(apiRef);\n      apiRef.current.setPageSize(visibleRowCount);\n    }\n    await updateGridColumnsForPrint(options == null ? void 0 : options.fields, options == null ? void 0 : options.allColumns);\n    apiRef.current.unstable_disableVirtualization();\n    await raf(); // wait for the state changes to take action\n    const printWindow = buildPrintWindow(options == null ? void 0 : options.fileName);\n    if (process.env.NODE_ENV === 'test') {\n      doc.current.body.appendChild(printWindow);\n      // In test env, run the all pipeline without waiting for loading\n      handlePrintWindowLoad(printWindow, options);\n      handlePrintWindowAfterPrint(printWindow);\n    } else {\n      printWindow.onload = () => {\n        handlePrintWindowLoad(printWindow, options);\n        const mediaQueryList = printWindow.contentWindow.matchMedia('print');\n        mediaQueryList.addEventListener('change', mql => {\n          const isAfterPrint = mql.matches === false;\n          if (isAfterPrint) {\n            handlePrintWindowAfterPrint(printWindow);\n          }\n        });\n      };\n      doc.current.body.appendChild(printWindow);\n    }\n  }, [props, logger, apiRef, handlePrintWindowLoad, handlePrintWindowAfterPrint, updateGridColumnsForPrint]);\n  const printExportApi = {\n    exportDataAsPrint\n  };\n  useGridApiMethod(apiRef, printExportApi, 'public');\n\n  /**\r\n   * PRE-PROCESSING\r\n   */\n  const addExportMenuButtons = React.useCallback((initialValue, options) => {\n    var _options$printOptions;\n    if ((_options$printOptions = options.printOptions) != null && _options$printOptions.disableToolbarButton) {\n      return initialValue;\n    }\n    return [...initialValue, {\n      component: /*#__PURE__*/_jsx(GridPrintExportMenuItem, {\n        options: options.printOptions\n      }),\n      componentName: 'printExport'\n    }];\n  }, []);\n  useGridRegisterPipeProcessor(apiRef, 'exportMenu', addExportMenuButtons);\n};","map":{"version":3,"names":["_extends","React","unstable_ownerDocument","ownerDocument","useGridLogger","gridExpandedRowCountSelector","gridColumnDefinitionsSelector","gridColumnVisibilityModelSelector","gridClasses","useGridApiMethod","gridRowsMetaSelector","getColumnsToExport","useGridRegisterPipeProcessor","GridPrintExportMenuItem","getTotalHeaderHeight","jsx","_jsx","raf","Promise","resolve","requestAnimationFrame","buildPrintWindow","title","iframeEl","document","createElement","style","position","width","height","useGridPrintExport","apiRef","props","logger","doc","useRef","previousGridState","previousColumnVisibility","useEffect","current","rootElementRef","updateGridColumnsForPrint","useCallback","fields","allColumns","exportedColumnFields","options","map","column","field","columns","newColumnVisibilityModel","forEach","includes","setColumnVisibilityModel","handlePrintWindowLoad","printWindow","_querySelector","_querySelector2","normalizeOptions","copyStyles","hideToolbar","hideFooter","printDoc","contentDocument","rowsMeta","state","gridRootElement","gridClone","cloneNode","gridMain","querySelector","main","overflow","contain","columnHeaders","columnHeadersInner","gridToolbarElementHeight","toolbarContainer","offsetHeight","gridFooterElementHeight","footerContainer","_gridClone$querySelec","remove","_gridClone$querySelec2","currentPageTotalHeight","columnHeaderHeight","boxSizing","container","appendChild","body","innerHTML","defaultPageStyle","pageStyle","styleElement","createTextNode","head","bodyClassName","classList","add","split","stylesheetLoadPromises","rootCandidate","getRootNode","root","constructor","name","headStyleElements","querySelectorAll","i","length","node","tagName","newHeadStyleElements","sheet","styleCSS","j","cssRules","cssText","getAttribute","attributes","attr","setAttribute","nodeName","nodeValue","push","addEventListener","process","env","NODE_ENV","all","then","contentWindow","print","handlePrintWindowAfterPrint","_previousGridState$cu","removeChild","restoreState","columnVisibilityModel","unstable_enableVirtualization","exportDataAsPrint","debug","Error","exportState","pagination","visibleRowCount","setPageSize","unstable_disableVirtualization","fileName","onload","mediaQueryList","matchMedia","mql","isAfterPrint","matches","printExportApi","addExportMenuButtons","initialValue","_options$printOptions","printOptions","disableToolbarButton","component","componentName"],"sources":["C:/Users/KhanhHQ/Desktop/test/node_modules/@mui/x-data-grid/hooks/features/export/useGridPrintExport.js"],"sourcesContent":["import _extends from \"@babel/runtime/helpers/esm/extends\";\r\nimport * as React from 'react';\r\nimport { unstable_ownerDocument as ownerDocument } from '@mui/utils';\r\nimport { useGridLogger } from '../../utils/useGridLogger';\r\nimport { gridExpandedRowCountSelector } from '../filter/gridFilterSelector';\r\nimport { gridColumnDefinitionsSelector, gridColumnVisibilityModelSelector } from '../columns/gridColumnsSelector';\r\nimport { gridClasses } from '../../../constants/gridClasses';\r\nimport { useGridApiMethod } from '../../utils/useGridApiMethod';\r\nimport { gridRowsMetaSelector } from '../rows/gridRowsMetaSelector';\r\nimport { getColumnsToExport } from './utils';\r\nimport { useGridRegisterPipeProcessor } from '../../core/pipeProcessing';\r\nimport { GridPrintExportMenuItem } from '../../../components/toolbar/GridToolbarExport';\r\nimport { getTotalHeaderHeight } from '../columns/gridColumnsUtils';\r\nimport { jsx as _jsx } from \"react/jsx-runtime\";\r\nfunction raf() {\r\n  return new Promise(resolve => {\r\n    requestAnimationFrame(() => {\r\n      resolve();\r\n    });\r\n  });\r\n}\r\nfunction buildPrintWindow(title) {\r\n  const iframeEl = document.createElement('iframe');\r\n  iframeEl.style.position = 'absolute';\r\n  iframeEl.style.width = '0px';\r\n  iframeEl.style.height = '0px';\r\n  iframeEl.title = title || document.title;\r\n  return iframeEl;\r\n}\r\n\r\n/**\r\n * @requires useGridColumns (state)\r\n * @requires useGridFilter (state)\r\n * @requires useGridSorting (state)\r\n * @requires useGridParamsApi (method)\r\n */\r\nexport const useGridPrintExport = (apiRef, props) => {\r\n  const logger = useGridLogger(apiRef, 'useGridPrintExport');\r\n  const doc = React.useRef(null);\r\n  const previousGridState = React.useRef(null);\r\n  const previousColumnVisibility = React.useRef({});\r\n  React.useEffect(() => {\r\n    doc.current = ownerDocument(apiRef.current.rootElementRef.current);\r\n  }, [apiRef]);\r\n\r\n  // Returns a promise because updateColumns triggers state update and\r\n  // the new state needs to be in place before the grid can be sized correctly\r\n  const updateGridColumnsForPrint = React.useCallback((fields, allColumns) => new Promise(resolve => {\r\n    // TODO remove unused Promise\r\n    if (!fields && !allColumns) {\r\n      resolve();\r\n      return;\r\n    }\r\n    const exportedColumnFields = getColumnsToExport({\r\n      apiRef,\r\n      options: {\r\n        fields,\r\n        allColumns\r\n      }\r\n    }).map(column => column.field);\r\n    const columns = gridColumnDefinitionsSelector(apiRef);\r\n    const newColumnVisibilityModel = {};\r\n    columns.forEach(column => {\r\n      newColumnVisibilityModel[column.field] = exportedColumnFields.includes(column.field);\r\n    });\r\n    apiRef.current.setColumnVisibilityModel(newColumnVisibilityModel);\r\n    resolve();\r\n  }), [apiRef]);\r\n  const handlePrintWindowLoad = React.useCallback((printWindow, options) => {\r\n    var _querySelector, _querySelector2;\r\n    const normalizeOptions = _extends({\r\n      copyStyles: true,\r\n      hideToolbar: false,\r\n      hideFooter: false\r\n    }, options);\r\n    const printDoc = printWindow.contentDocument;\r\n    if (!printDoc) {\r\n      return;\r\n    }\r\n    const rowsMeta = gridRowsMetaSelector(apiRef.current.state);\r\n    const gridRootElement = apiRef.current.rootElementRef.current;\r\n    const gridClone = gridRootElement.cloneNode(true);\r\n\r\n    // Allow to overflow to not hide the border of the last row\r\n    const gridMain = gridClone.querySelector(`.${gridClasses.main}`);\r\n    gridMain.style.overflow = 'visible';\r\n\r\n    // See https://support.google.com/chrome/thread/191619088?hl=en&msgid=193009642\r\n    gridClone.style.contain = 'size';\r\n    const columnHeaders = gridClone.querySelector(`.${gridClasses.columnHeaders}`);\r\n    const columnHeadersInner = columnHeaders.querySelector(`.${gridClasses.columnHeadersInner}`);\r\n    columnHeadersInner.style.width = '100%';\r\n    let gridToolbarElementHeight = ((_querySelector = gridRootElement.querySelector(`.${gridClasses.toolbarContainer}`)) == null ? void 0 : _querySelector.offsetHeight) || 0;\r\n    let gridFooterElementHeight = ((_querySelector2 = gridRootElement.querySelector(`.${gridClasses.footerContainer}`)) == null ? void 0 : _querySelector2.offsetHeight) || 0;\r\n    if (normalizeOptions.hideToolbar) {\r\n      var _gridClone$querySelec;\r\n      (_gridClone$querySelec = gridClone.querySelector(`.${gridClasses.toolbarContainer}`)) == null ? void 0 : _gridClone$querySelec.remove();\r\n      gridToolbarElementHeight = 0;\r\n    }\r\n    if (normalizeOptions.hideFooter) {\r\n      var _gridClone$querySelec2;\r\n      (_gridClone$querySelec2 = gridClone.querySelector(`.${gridClasses.footerContainer}`)) == null ? void 0 : _gridClone$querySelec2.remove();\r\n      gridFooterElementHeight = 0;\r\n    }\r\n\r\n    // Expand container height to accommodate all rows\r\n    gridClone.style.height = `${rowsMeta.currentPageTotalHeight + getTotalHeaderHeight(apiRef, props.columnHeaderHeight) + gridToolbarElementHeight + gridFooterElementHeight}px`;\r\n    // The height above does not include grid border width, so we need to exclude it\r\n    gridClone.style.boxSizing = 'content-box';\r\n\r\n    // printDoc.body.appendChild(gridClone); should be enough but a clone isolation bug in Safari\r\n    // prevents us to do it\r\n    const container = document.createElement('div');\r\n    container.appendChild(gridClone);\r\n    printDoc.body.innerHTML = container.innerHTML;\r\n    const defaultPageStyle = typeof normalizeOptions.pageStyle === 'function' ? normalizeOptions.pageStyle() : normalizeOptions.pageStyle;\r\n    if (typeof defaultPageStyle === 'string') {\r\n      // TODO custom styles should always win\r\n      const styleElement = printDoc.createElement('style');\r\n      styleElement.appendChild(printDoc.createTextNode(defaultPageStyle));\r\n      printDoc.head.appendChild(styleElement);\r\n    }\r\n    if (normalizeOptions.bodyClassName) {\r\n      printDoc.body.classList.add(...normalizeOptions.bodyClassName.split(' '));\r\n    }\r\n    const stylesheetLoadPromises = [];\r\n    if (normalizeOptions.copyStyles) {\r\n      const rootCandidate = gridRootElement.getRootNode();\r\n      const root = rootCandidate.constructor.name === 'ShadowRoot' ? rootCandidate : doc.current;\r\n      const headStyleElements = root.querySelectorAll(\"style, link[rel='stylesheet']\");\r\n      for (let i = 0; i < headStyleElements.length; i += 1) {\r\n        const node = headStyleElements[i];\r\n        if (node.tagName === 'STYLE') {\r\n          const newHeadStyleElements = printDoc.createElement(node.tagName);\r\n          const sheet = node.sheet;\r\n          if (sheet) {\r\n            let styleCSS = '';\r\n            // NOTE: for-of is not supported by IE\r\n            for (let j = 0; j < sheet.cssRules.length; j += 1) {\r\n              if (typeof sheet.cssRules[j].cssText === 'string') {\r\n                styleCSS += `${sheet.cssRules[j].cssText}\\r\\n`;\r\n              }\r\n            }\r\n            newHeadStyleElements.appendChild(printDoc.createTextNode(styleCSS));\r\n            printDoc.head.appendChild(newHeadStyleElements);\r\n          }\r\n        } else if (node.getAttribute('href')) {\r\n          // If `href` tag is empty, avoid loading these links\r\n\r\n          const newHeadStyleElements = printDoc.createElement(node.tagName);\r\n          for (let j = 0; j < node.attributes.length; j += 1) {\r\n            const attr = node.attributes[j];\r\n            if (attr) {\r\n              newHeadStyleElements.setAttribute(attr.nodeName, attr.nodeValue || '');\r\n            }\r\n          }\r\n          stylesheetLoadPromises.push(new Promise(resolve => {\r\n            newHeadStyleElements.addEventListener('load', () => resolve());\r\n          }));\r\n          printDoc.head.appendChild(newHeadStyleElements);\r\n        }\r\n      }\r\n    }\r\n\r\n    // Trigger print\r\n    if (process.env.NODE_ENV !== 'test') {\r\n      // wait for remote stylesheets to load\r\n      Promise.all(stylesheetLoadPromises).then(() => {\r\n        printWindow.contentWindow.print();\r\n      });\r\n    }\r\n  }, [apiRef, doc, props.columnHeaderHeight]);\r\n  const handlePrintWindowAfterPrint = React.useCallback(printWindow => {\r\n    var _previousGridState$cu;\r\n    // Remove the print iframe\r\n    doc.current.body.removeChild(printWindow);\r\n\r\n    // Revert grid to previous state\r\n    apiRef.current.restoreState(previousGridState.current || {});\r\n    if (!((_previousGridState$cu = previousGridState.current) != null && (_previousGridState$cu = _previousGridState$cu.columns) != null && _previousGridState$cu.columnVisibilityModel)) {\r\n      // if the apiRef.current.exportState(); did not exported the column visibility, we update it\r\n      apiRef.current.setColumnVisibilityModel(previousColumnVisibility.current);\r\n    }\r\n    apiRef.current.unstable_enableVirtualization();\r\n\r\n    // Clear local state\r\n    previousGridState.current = null;\r\n    previousColumnVisibility.current = {};\r\n  }, [apiRef]);\r\n  const exportDataAsPrint = React.useCallback(async options => {\r\n    logger.debug(`Export data as Print`);\r\n    if (!apiRef.current.rootElementRef.current) {\r\n      throw new Error('MUI: No grid root element available.');\r\n    }\r\n    previousGridState.current = apiRef.current.exportState();\r\n    // It appends that the visibility model is not exported, especially if columnVisibility is not controlled\r\n    previousColumnVisibility.current = gridColumnVisibilityModelSelector(apiRef);\r\n    if (props.pagination) {\r\n      const visibleRowCount = gridExpandedRowCountSelector(apiRef);\r\n      apiRef.current.setPageSize(visibleRowCount);\r\n    }\r\n    await updateGridColumnsForPrint(options == null ? void 0 : options.fields, options == null ? void 0 : options.allColumns);\r\n    apiRef.current.unstable_disableVirtualization();\r\n    await raf(); // wait for the state changes to take action\r\n    const printWindow = buildPrintWindow(options == null ? void 0 : options.fileName);\r\n    if (process.env.NODE_ENV === 'test') {\r\n      doc.current.body.appendChild(printWindow);\r\n      // In test env, run the all pipeline without waiting for loading\r\n      handlePrintWindowLoad(printWindow, options);\r\n      handlePrintWindowAfterPrint(printWindow);\r\n    } else {\r\n      printWindow.onload = () => {\r\n        handlePrintWindowLoad(printWindow, options);\r\n        const mediaQueryList = printWindow.contentWindow.matchMedia('print');\r\n        mediaQueryList.addEventListener('change', mql => {\r\n          const isAfterPrint = mql.matches === false;\r\n          if (isAfterPrint) {\r\n            handlePrintWindowAfterPrint(printWindow);\r\n          }\r\n        });\r\n      };\r\n      doc.current.body.appendChild(printWindow);\r\n    }\r\n  }, [props, logger, apiRef, handlePrintWindowLoad, handlePrintWindowAfterPrint, updateGridColumnsForPrint]);\r\n  const printExportApi = {\r\n    exportDataAsPrint\r\n  };\r\n  useGridApiMethod(apiRef, printExportApi, 'public');\r\n\r\n  /**\r\n   * PRE-PROCESSING\r\n   */\r\n  const addExportMenuButtons = React.useCallback((initialValue, options) => {\r\n    var _options$printOptions;\r\n    if ((_options$printOptions = options.printOptions) != null && _options$printOptions.disableToolbarButton) {\r\n      return initialValue;\r\n    }\r\n    return [...initialValue, {\r\n      component: /*#__PURE__*/_jsx(GridPrintExportMenuItem, {\r\n        options: options.printOptions\r\n      }),\r\n      componentName: 'printExport'\r\n    }];\r\n  }, []);\r\n  useGridRegisterPipeProcessor(apiRef, 'exportMenu', addExportMenuButtons);\r\n};"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}